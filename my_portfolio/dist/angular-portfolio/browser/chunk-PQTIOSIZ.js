import{Ed as ht,Md as lt,Qg as dt,ee as W,fe as F,kd as rt,od as C,q as N,yd as ct}from"./chunk-FHHCV3IC.js";import{g as ot,h as nt}from"./chunk-T5TZ2UDS.js";import{Ga as Z,Ja as Q,P as Y,Pa as J,Ta as K,Ya as w,Za as S,_a as x,ab as $,ea as U,fb as tt,gb as et,hb as it,ib as st,ja as k,sb as at,wa as j,xa as q}from"./chunk-P2IXOKJJ.js";import{d as T}from"./chunk-4CLCTAJ7.js";var ft=["canvas"];function yt(I,i){I&1&&(w(0,"div",5),x(1,"div",6),w(2,"span"),st(3,"Loading..."),S()())}var mt=class I{canvasRef;videoSrc;containerClasses="w-full h-96";isLoading=k(!1);scene;camera;renderer;points;geometry;material;glowLayers=[];animationId=0;video;canvas2D;ctx2D;GRID_WIDTH=320;GRID_HEIGHT=180;POINTS_COUNT=this.GRID_WIDTH*this.GRID_HEIGHT;mouseX=0;mouseY=0;isMouseOverCanvas=!1;glitchTime=0;glitchIntensity=0;resizeObserver;scatterIntensityMap=new Float32Array(this.POINTS_COUNT);scatterDecayMap=new Float32Array(this.POINTS_COUNT);MAX_SCATTER_DISTANCE=600;SCATTER_STRENGTH=45;GLOW_INTENSITY=4;tempPositions=new Float32Array(this.POINTS_COUNT*3);tempColors=new Float32Array(this.POINTS_COUNT*3);patternAnimationId=0;isDestroyed=!1;ngZone=Y(U);constructor(){at(()=>{this.material&&(this.material.size=6)})}ngOnInit(){return T(this,null,function*(){this.initThreeJS(),this.createPointCloud(),yield this.setupVideo(),this.setupEventListeners(),this.setupResizeObserver(),this.ngZone.runOutsideAngular(()=>{this.animate()}),this.onWindowResize(),this.videoSrc&&(yield this.loadVideoFromSrc(this.videoSrc))})}ngOnDestroy(){this.cleanup()}cleanup(){this.isDestroyed=!0,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=0),this.patternAnimationId&&(cancelAnimationFrame(this.patternAnimationId),this.patternAnimationId=0),this.resizeObserver&&this.resizeObserver.disconnect(),this.video&&(this.video.pause(),this.video.srcObject&&this.video.srcObject.getTracks().forEach(e=>e.stop()),this.video.src="",this.video.srcObject=null,this.video.load()),this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.glowLayers.forEach(i=>{i.geometry&&i.geometry.dispose(),i.points.material&&i.points.material.dispose(),this.scene&&this.scene.remove(i.points)}),this.glowLayers=[],this.points&&this.scene&&this.scene.remove(this.points),this.renderer&&(this.renderer.dispose(),this.renderer.forceContextLoss())}initThreeJS(){let i=this.canvasRef.nativeElement;this.scene=new lt,this.scene.background=new rt(658708),this.camera=new ht(40,1,1,1e4),this.camera.position.set(0,0,800),this.camera.lookAt(0,0,0),this.renderer=new dt({canvas:i,antialias:!0,powerPreference:"high-performance"}),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))}setupResizeObserver(){let i=this.canvasRef.nativeElement;this.resizeObserver=new ResizeObserver(e=>{for(let s of e){let{width:o,height:n}=s.contentRect;o>0&&n>0&&this.handleResize(o,n)}}),this.resizeObserver.observe(i)}handleResize(i,e){this.camera.aspect=i/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(i,e,!1);let s=this.camera.fov*(Math.PI/180),o=this.GRID_HEIGHT*12,n=this.GRID_WIDTH*12,l=s,t=2*Math.atan(Math.tan(s/2)*this.camera.aspect),a=o/2/Math.tan(l/2),r=n/2/Math.tan(t/2);this.camera.position.z=Math.max(a,r)*.95}onWindowResize(){let e=this.canvasRef.nativeElement.getBoundingClientRect();e.width>0&&e.height>0&&this.handleResize(e.width,e.height)}createPointCloud(){this.geometry=new ct;let i=new Float32Array(this.POINTS_COUNT*3),e=new Float32Array(this.POINTS_COUNT*3),s=new Float32Array(this.POINTS_COUNT*3),o=0;for(let n=0;n<this.GRID_HEIGHT;n++)for(let l=0;l<this.GRID_WIDTH;l++){let t=(l-this.GRID_WIDTH/2)*12,a=-(n-this.GRID_HEIGHT/2)*12;i[o*3]=t,i[o*3+1]=a,i[o*3+2]=0,s[o*3]=t,s[o*3+1]=a,s[o*3+2]=0,e[o*3]=e[o*3+1]=e[o*3+2]=.8,this.scatterIntensityMap[o]=0,this.scatterDecayMap[o]=0,o++}this.geometry.setAttribute("position",new C(i,3)),this.geometry.setAttribute("color",new C(e,3)),this.geometry.setAttribute("originalPosition",new C(s,3)),this.material=new W({size:6,vertexColors:!0,transparent:!0,opacity:1,alphaTest:.5,depthWrite:!1,blending:N,sizeAttenuation:!0}),this.points=new F(this.geometry,this.material),this.scene.add(this.points),this.createGlowLayers()}createGlowLayers(){for(let i=1;i<=3;i++){let e=this.geometry.clone(),s=new W({size:6*(1+i*.6),vertexColors:!0,transparent:!0,opacity:.4/i,alphaTest:.1,depthWrite:!1,blending:N,sizeAttenuation:!0}),o=new F(e,s);this.scene.add(o),this.glowLayers.push({points:o,geometry:e})}}setupVideo(){return T(this,null,function*(){this.video=document.createElement("video"),this.video.width=this.GRID_WIDTH,this.video.height=this.GRID_HEIGHT,this.video.autoplay=!0,this.video.muted=!0,this.video.loop=!0,this.video.preload="auto",this.video.setAttribute("playsinline","true"),this.canvas2D=document.createElement("canvas"),this.canvas2D.width=this.GRID_WIDTH,this.canvas2D.height=this.GRID_HEIGHT,this.ctx2D=this.canvas2D.getContext("2d"),yield this.createAnimatedPattern()})}createAnimatedPattern(){return T(this,null,function*(){let i=document.createElement("canvas");i.width=this.GRID_WIDTH,i.height=this.GRID_HEIGHT;let e=i.getContext("2d"),s=0,o=()=>{if(this.isDestroyed)return;let n=e.createImageData(this.GRID_WIDTH,this.GRID_HEIGHT),l=n.data;for(let t=0;t<this.GRID_HEIGHT;t++)for(let a=0;a<this.GRID_WIDTH;a++){let r=(t*this.GRID_WIDTH+a)*4,h=this.GRID_WIDTH/2,c=this.GRID_HEIGHT/2,u=Math.sqrt((a-h)**2+(t-c)**2),g=Math.sin(u*.08+s*.04)*.5+.5,_=Math.sin(a*.05+s*.015)*Math.cos(t*.05+s*.02),f=Math.max(0,Math.min(255,(g+_*.4)*255));l[r]=f,l[r+1]=f*.85,l[r+2]=f*.7,l[r+3]=255}e.putImageData(n,0,0),s++,this.isDestroyed||(this.patternAnimationId=requestAnimationFrame(o))};this.ngZone.runOutsideAngular(()=>{o()});try{let n=i.captureStream(30);this.video.srcObject=n,yield this.video.play()}catch(n){console.warn("Pattern video setup failed:",n)}})}updatePointCloud(){if(!this.video.videoWidth||!this.video.videoHeight)return;this.glitchTime++,Math.random()<.008&&(this.glitchIntensity=Math.random()*1.2+.6,setTimeout(()=>this.glitchIntensity=0,Math.random()*500+150)),this.ctx2D.drawImage(this.video,0,0,this.GRID_WIDTH,this.GRID_HEIGHT);let e=this.ctx2D.getImageData(0,0,this.GRID_WIDTH,this.GRID_HEIGHT).data,s=this.geometry.attributes.position.array,o=this.geometry.attributes.color.array,n=this.geometry.attributes.originalPosition.array,l=this.canvasRef.nativeElement.getBoundingClientRect(),t=(this.mouseX/l.width*2-1)*(this.GRID_WIDTH*6),a=-(this.mouseY/l.height*2-1)*(this.GRID_HEIGHT*6),r=this.glitchIntensity>0;if(this.glitchTime%300===0)for(let c=0;c<this.POINTS_COUNT;c++)this.scatterDecayMap[c]<.01&&(this.scatterDecayMap[c]=0,this.scatterIntensityMap[c]=0);for(let c=0;c<this.POINTS_COUNT;c++)this.scatterDecayMap[c]>0&&(this.scatterDecayMap[c]*=.92,this.scatterDecayMap[c]<.01&&(this.scatterDecayMap[c]=0,this.scatterIntensityMap[c]=0));let h=0;for(let c=0;c<this.GRID_HEIGHT;c++)for(let u=0;u<this.GRID_WIDTH;u++){let g=(c*this.GRID_WIDTH+u)*4,_=e[g],f=e[g+1],pt=e[g+2],b=(_+f+pt)/3;if(b<=40){s[h*3]=s[h*3+1]=0,s[h*3+2]=-1e4,o[h*3]=o[h*3+1]=o[h*3+2]=0,h++;continue}let G=b/255;G=Math.pow(G,2.2);let vt=G*400-200,E=n[h*3],R=n[h*3+1],O=Math.sqrt(Math.pow(E-t,2)+Math.pow(R-a,2)),H=0,D=0,A=0,d=this.scatterIntensityMap[h];if(this.isMouseOverCanvas&&O<this.MAX_SCATTER_DISTANCE){let v=Math.pow(1-O/this.MAX_SCATTER_DISTANCE,1.5)*this.SCATTER_STRENGTH;v>d&&(this.scatterIntensityMap[h]=v,this.scatterDecayMap[h]=1,d=v);let m=E-t,p=R-a,y=Math.sqrt(m*m+p*p);if(y>0){let P=.6+Math.random()*.8,X=1.5+Math.random()*.5;H=m/y*d*P*X,D=p/y*d*P*X,A=d*.6*P;let ut=-p/y,gt=m/y,B=(Math.random()-.5)*d*.5;H+=ut*B,D+=gt*B}}else if(d>0){let M=this.scatterDecayMap[h],v=E-t,m=R-a,p=Math.sqrt(v*v+m*m);p>0&&(H=v/p*d*M,D=m/p*d*M,A=d*.4*M)}let L=0,z=0,V=0;r&&(L=(Math.random()-.5)*this.glitchIntensity*35,z=(Math.random()-.5)*this.glitchIntensity*35,V=(Math.random()-.5)*this.glitchIntensity*30),s[h*3]=E+H+L,s[h*3+1]=R+D+z,s[h*3+2]=vt+A+V,this.applyEnhancedHolographicColors(o,h,b,O,d,r),h++}this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.updateGlowLayers()}applyEnhancedHolographicColors(i,e,s,o,n,l){let t=[.5,.5,.5];s>220?t=[.95,.95,.95]:s>180?t=[.85,.85,.85]:s>140?t=[.7,.7,.7]:s>100?t=[.55,.55,.55]:s>60?t=[.4,.4,.4]:t=[.25,.25,.25];let a=e%5/25;if(t[0]+=a*.08,t[1]+=a*.04,t[2]+=a*.12,n>0){let r=n/this.SCATTER_STRENGTH*this.GLOW_INTENSITY;r>2?t=[1,1,1]:r>1?(t[0]=Math.min(1,t[0]+r*.8),t[1]=Math.min(1,t[1]+r*.9),t[2]=Math.min(1,t[2]+r*1)):(t[0]=Math.min(1,t[0]+r*.6),t[1]=Math.min(1,t[1]+r*.8),t[2]=Math.min(1,t[2]+r*1)),n>this.SCATTER_STRENGTH*.7&&(t[0]=t[1]=t[2]=1)}if(l){let r=this.glitchIntensity*.8;t[0]=Math.min(1,t[0]+r),t[1]=Math.min(1,t[1]+r),t[2]=Math.min(1,t[2]+r),Math.random()<.25&&(t[0]=t[1]=t[2]=1)}i[e*3]=t[0],i[e*3+1]=t[1],i[e*3+2]=t[2]}updateGlowLayers(){let i=this.geometry.attributes.position.array,e=this.geometry.attributes.color.array;this.glowLayers.forEach((s,o)=>{let n=s.geometry.attributes.position.array,l=s.geometry.attributes.color.array;for(let a=0;a<i.length;a+=3)n[a]=i[a],n[a+1]=i[a+1],n[a+2]=i[a+2]-(o+1)*4;let t=.9/(o+1);for(let a=0;a<e.length;a+=3){let r=(e[a]+e[a+1]+e[a+2])/3,c=r>.9?2.5:r>.8?1.8:1;l[a]=e[a]*t*c,l[a+1]=e[a+1]*t*c,l[a+2]=e[a+2]*t*c}s.geometry.attributes.position.needsUpdate=!0,s.geometry.attributes.color.needsUpdate=!0})}setupEventListeners(){let i=this.canvasRef.nativeElement;i.addEventListener("mousemove",e=>{let s=i.getBoundingClientRect();this.mouseX=e.clientX-s.left,this.mouseY=e.clientY-s.top}),i.addEventListener("mouseenter",()=>this.isMouseOverCanvas=!0),i.addEventListener("mouseleave",()=>{this.isMouseOverCanvas=!1})}animate(){this.isDestroyed||(this.animationId=requestAnimationFrame(()=>this.animate()),this.updatePointCloud(),this.renderer.render(this.scene,this.camera))}loadVideoFromSrc(i){return T(this,null,function*(){try{this.video.srcObject&&(this.video.srcObject.getTracks().forEach(s=>s.stop()),this.video.srcObject=null),this.video.src=i,this.video.loop=!0,this.video.muted=!0,this.video.autoplay=!0,this.video.load(),yield this.video.play()}catch(e){console.warn("Video load failed:",e)}})}get isLoadingValue(){return this.isLoading()}static \u0275fac=function(e){return new(e||I)};static \u0275cmp=Z({type:I,selectors:[["app-holo-video-container"]],viewQuery:function(e,s){if(e&1&&tt(ft,7),e&2){let o;et(o=it())&&(s.canvasRef=o.first)}},hostBindings:function(e,s){e&1&&$("resize",function(){return s.onWindowResize()},!1,j)},inputs:{videoSrc:"videoSrc",containerClasses:"containerClasses"},decls:6,vars:2,consts:[["canvas",""],[1,"block","w-full","h-full",3,"ngClass"],[1,"bg-slate-900","rounded-lg","overflow-hidden","w-full","h-full"],[1,"relative","w-full","h-full"],[1,"block","w-full","h-full","cursor-grab","active:cursor-grabbing"],[1,"absolute","inset-0","bg-black/80","flex","items-center","justify-center","flex-col","text-green-400","text-lg","font-sans","z-10"],[1,"w-10","h-10","border-3","border-gray-600","border-t-green-400","rounded-full","animate-spin","mb-4"]],template:function(e,s){e&1&&(w(0,"div",1)(1,"div",2)(2,"div",3),x(3,"canvas",4,0),Q(5,yt,4,0,"div",5),S()()()),e&2&&(J("ngClass",s.containerClasses),q(5),K(s.isLoadingValue?5:-1))},dependencies:[nt,ot],styles:["[_nghost-%COMP%]{display:block;height:100%;width:100%}.border-3[_ngcontent-%COMP%]{border-width:3px}.backdrop-blur-sm[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.shadow-cyan-500\\/30[_ngcontent-%COMP%]{box-shadow:0 0 20px #06b6d44d}@media (max-width:840px){.w-\\__ph-0__[_ngcontent-%COMP%]{max-width:800px;width:100%}.h-\\__ph-0__[_ngcontent-%COMP%]{height:60vw;max-height:600px}}@media (max-width:768px){.absolute.top-5.right-5[_ngcontent-%COMP%]{inset:.625rem .625rem auto}.absolute.top-5.right-5[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{justify-content:center;width:100%}}"]})};export{mt as a};
