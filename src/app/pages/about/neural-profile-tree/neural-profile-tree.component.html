<div class="flex flex-col md:flex-row gap-6 h-auto w-full">
  <!-- Tree Component -->
  <div
    class="hidden md:block bg-nier-bg border-2 border-nier-border text-nier-dark flex-1 font-terminal text-sm md:text-base lg:text-lg leading-relaxed p-4 md:p-6 h-auto">
    @for (node of treeData(); track node.id) {
    <div class="tree-node-item cursor-pointer flex items-center group py-0.5"
      [class.selected-node]="selectedNodeId() === node.id" [class.hovered-node]="hoveredNodeId() === node.id"
      [style.padding-left]="getIndentPadding(node.level)" (click)="selectNode(node)" (mouseenter)="hoverNode(node)"
      (mouseleave)="clearHover()">

      <!-- Dynamic Tree Lines -->
      <span class="mr-2 opacity-60 font-mono text-xs md:text-sm lg:text-base">
        @if (node.level > 0) {
        <span class="tree-line">│</span>
        <span class="tree-branch">{{ isLastChild(node) ? '└──' : '├──' }}</span>
        } @else {
        <span class="tree-root">></span>
        }
      </span>

      <!-- Folder/Leaf Icon -->
      <span class="mr-2 opacity-70">
        @if (node.hasChildren) {
        <span class="text-xs transition-transform duration-200 inline-block" [class.rotate-90]="node.isExpanded"
          (click)="$event.stopPropagation(); toggleExpand(node)">▶</span>
        } @else {
        <span class="text-[10px] opacity-40">■</span>
        }
      </span>

      <span class="detail-value flex-1 truncate transition-colors duration-200">
        {{ node.title }}
      </span>

      <!-- Scan line effect on hover -->
      <div class="scan-line"></div>
    </div>
    }
  </div>

  <!-- Chip Slots Container -->
  <article
    class="flex flex-col bg-nier-bg border-nier-border w-full md:w-80 h-auto p-4 md:p-6 gap-4 self-stretch font-terminal border-t-2 md:border-t-0 md:border-2 md:border-l-0">
    <!-- Cell 1: Development / Front -->
    <div class="chip-container transition-all duration-300" [class.opacity-100]="getVisualState(1) === 'selected'"
      [class.opacity-50]="getVisualState(1) !== 'selected'">
      <div class="border border-nier-border p-3 relative bg-nier-dark/5">
        <div class="text-xs text-nier-mid mb-2 uppercase tracking-wider">01 // Front</div>
        @if (activeNodeDetails()?.linkedCell === 1) {
        <div class="text-nier-dark font-bold text-lg mb-2">{{ activeNodeDetails()?.title }}</div>
        <div class="flex flex-wrap gap-2">
          @for (skill of activeNodeDetails()?.skills; track skill) {
          <span class="text-xs px-2 py-1 bg-nier-accent/10 text-nier-accent border border-nier-accent/30">{{ skill
            }}</span>
          }
        </div>
        } @else {
        <!-- Mobile: Show static skills -->
        <div class="md:hidden flex flex-wrap gap-2">
          <span class="mobile-skill-tag">React</span>
          <span class="mobile-skill-tag">Angular</span>
          <span class="mobile-skill-tag">Tailwind</span>
          <span class="mobile-skill-tag">Three.js</span>
        </div>
        <!-- Desktop: Show waiting -->
        <div class="hidden md:block text-nier-mid/50 text-sm italic">...waiting for input...</div>
        }
        <span class="scan-line"></span>
      </div>
    </div>

    <!-- Cell 2: Development / Back -->
    <div class="chip-container transition-all duration-300" [class.opacity-100]="getVisualState(2) === 'selected'"
      [class.opacity-50]="getVisualState(2) !== 'selected'">
      <div class="border border-nier-border p-3 relative bg-nier-dark/5">
        <div class="text-xs text-nier-mid mb-2 uppercase tracking-wider">02 // Back</div>
        @if (activeNodeDetails()?.linkedCell === 2) {
        <div class="text-nier-dark font-bold text-lg mb-2">{{ activeNodeDetails()?.title }}</div>
        <div class="flex flex-wrap gap-2">
          @for (skill of activeNodeDetails()?.skills; track skill) {
          <span class="text-xs px-2 py-1 bg-nier-accent/10 text-nier-accent border border-nier-accent/30">{{ skill
            }}</span>
          }
        </div>
        } @else {
        <!-- Mobile: Show static skills -->
        <div class="md:hidden flex flex-wrap gap-2">
          <span class="mobile-skill-tag">Node.js</span>
          <span class="mobile-skill-tag">PHP</span>
          <span class="mobile-skill-tag">Python</span>
          <span class="mobile-skill-tag">Java</span>
        </div>
        <!-- Desktop: Show waiting -->
        <div class="hidden md:block text-nier-mid/50 text-sm italic">...waiting for input...</div>
        }
        <span class="scan-line"></span>
      </div>
    </div>

    <!-- Cell 3: Infrastructure / Orchestration -->
    <div class="chip-container transition-all duration-300" [class.opacity-100]="getVisualState(3) === 'selected'"
      [class.opacity-50]="getVisualState(3) !== 'selected'">
      <div class="border border-nier-border p-3 relative bg-nier-dark/5">
        <div class="text-xs text-nier-mid mb-2 uppercase tracking-wider">03 // Orchestration</div>
        @if (activeNodeDetails()?.linkedCell === 3) {
        <div class="text-nier-dark font-bold text-lg mb-2">{{ activeNodeDetails()?.title }}</div>
        <div class="flex flex-wrap gap-2">
          @for (skill of activeNodeDetails()?.skills; track skill) {
          <span class="text-xs px-2 py-1 bg-nier-accent/10 text-nier-accent border border-nier-accent/30">{{ skill
            }}</span>
          }
        </div>
        } @else {
        <!-- Mobile: Show static skills -->
        <div class="md:hidden flex flex-wrap gap-2">
          <span class="mobile-skill-tag">Docker</span>
          <span class="mobile-skill-tag">K8s</span>
          <span class="mobile-skill-tag">Terraform</span>
          <span class="mobile-skill-tag">Ansible</span>
        </div>
        <!-- Desktop: Show waiting -->
        <div class="hidden md:block text-nier-mid/50 text-sm italic">...waiting for input...</div>
        }
        <span class="scan-line"></span>
      </div>
    </div>

    <!-- Cell 4: Infrastructure / Security or Data -->
    <div class="chip-container transition-all duration-300" [class.opacity-100]="getVisualState(4) === 'selected'"
      [class.opacity-50]="getVisualState(4) !== 'selected'">
      <div class="border border-nier-border p-3 relative bg-nier-dark/5">
        <div class="text-xs text-nier-mid mb-2 uppercase tracking-wider">04 // Security / Data</div>
        @if (activeNodeDetails()?.linkedCell === 4) {
        <div class="text-nier-dark font-bold text-lg mb-2">{{ activeNodeDetails()?.title }}</div>
        <div class="flex flex-wrap gap-2">
          @for (skill of activeNodeDetails()?.skills; track skill) {
          <span class="text-xs px-2 py-1 bg-nier-accent/10 text-nier-accent border border-nier-accent/30">{{ skill
            }}</span>
          }
        </div>
        } @else {
        <!-- Mobile: Show static skills -->
        <div class="md:hidden flex flex-wrap gap-2">
          <span class="mobile-skill-tag">Prometheus</span>
          <span class="mobile-skill-tag">Grafana</span>
          <span class="mobile-skill-tag">PostgreSQL</span>
          <span class="mobile-skill-tag">MongoDB</span>
        </div>
        <!-- Desktop: Show waiting -->
        <div class="hidden md:block text-nier-mid/50 text-sm italic">...waiting for input...</div>
        }
        <span class="scan-line"></span>
      </div>
    </div>

    <!-- Locked Category -->
    <div class="chip-container chip-locked-category">
      <div class="chip-parent locked-parent">
        <div class="locked-content">
          <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <circle cx="12" cy="12" r="3" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
        </div>
      </div>
    </div>
  </article>
</div>